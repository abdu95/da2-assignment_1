---
title:  "DA2: Assignment 1"
author: "Abduvosid Malikov"
date: "29 November"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
    css: style.css
---

## Introduction

This is the Assignment 1 for `Data Analysis 2`  and `Coding` course. The aim of this project is  to analyse the pattern of association between **registered COVID-19 cases** and **registered number of death** due to COVID-19 on 10-31-2020. 
As a source, [covid-19 data](https://github.com/CSSEGISandData/COVID-19/blob/master/csse_covid_19_data/csse_covid_19_daily_reports/10-31-2020.csv) from CSSE^[Center for Systems Science and Engineering] was used. The *population* is all cases reported in CSSE dataset starting from 01-22-2020 until now (the last added report date was 11-28-2020). The *sample* is the dataset that contains confirmed and death cases only from one date: 10-31-2020. The variables that are used are:

* country: string value showing the name of the country
* confirmed: numeric value showing the number of confirmed cases of COVID
* death: numeric value showing the number of death cases from COVID 
* population: numeric value showing the population of the country
* ln_confirmed: log of number of confirmed cases
* ln_death: log of number of death cases

Invalid data (measuring flu cases instead of COVID), unreliable data (showing one value today and showing enormously different value tomorrow) and missing values are the potential data quality issues. 

The dependent (y) variable is *Number of registered death* and explanatory (x) variable is *Number of registered case*. Note that this is
only a `potential' variable, thus you may transform it with ln transformation, if you decide.

``` {r, warning = FALSE, message = FALSE, include = FALSE}
library(knitr)
library(tidyverse)
require(scales)
library(lspline)
library(estimatr)
library(texreg)
library(ggthemes)

my_file <- "../data/clean/covid_pop_09_11_2020_clean.csv"

# make dataframe from a file
df <- read_csv(my_file)
```

``` {r, echo = FALSE, warning = FALSE, message = FALSE}

df %>%
  keep(is.numeric) %>% 
  gather() %>% 
  ggplot(aes(value)) +
  facet_wrap(~key, scales = "free") +
  geom_histogram()+
  theme_wsj() + 
  scale_fill_wsj()


# summary( df )
```

``` {r, warning = FALSE, message = FALSE, include = FALSE}

#' Check and report your distributions for y and x variables: 
#' use histograms and summary statistics table 
#' (mean, median, min, max, standard deviation)

summary_stats_death <- df %>% summarise(
  mean = mean(death),
  median = median(death),
  std = sd(death),
  min = min(death),
  max = max(death))

summary_stats_confirmed <- df %>% summarise(
  mean = mean(confirmed),
  median = median(confirmed),
  std = sd(confirmed),
  min = min(confirmed),
  max = max(confirmed))
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}
kable(summary_stats_death, caption = "Summary statistics on number of death")

kable(summary_stats_confirmed, caption = "Summary statistics on number of confirmed cases") 

```


## level - level
does not give better interpretation
There are some influential observations that governing the conditional mean. 

```{r, echo = FALSE, warning = FALSE, message = FALSE}
# No_of_death - No_of_confirmed: level-level model without scaling
# model is not capturing the data very well. model does not fit the data
ggplot( df , aes(x = confirmed, y = death)) +
  geom_point() +
  geom_smooth(method="loess")+
  labs(x = "Number of registered case (31 October 2020)",y = "Number of registered death") 

```

## level y - log x
capturing the non-linearity in data
```{r, echo = FALSE, warning = FALSE, message = FALSE}
ggplot( df , aes(x = confirmed, y = death)) +
  geom_point() +
  geom_smooth(method="loess")+
  labs(x = "Number of registered case (31 October 2020, ln scale)",y = "Number of registered death") +
  scale_x_continuous( trans = log_trans() )
```

## log y - level x

non-linear

Figure 8.6 A, p214

Most of the observations are very close to each other at the bottom of the distribution of Number of registered cases.



```{r, echo = FALSE, warning = FALSE, message = FALSE}

ggplot( df , aes(x = confirmed, y = death)) +
  geom_point() +
  geom_smooth(method="loess")+
  labs(x = "Number of registered case (31 October 2020)",y = "Number of registered death (ln scale)") +
  scale_y_continuous( trans = log_trans() )
```

## log y - log x

Taking log of number of registered death and log of number of registered case is making the association close to linear

```{r, echo = FALSE, warning = FALSE, message = FALSE}

ggplot( df , aes(x = confirmed, y = death ))  +
  geom_point() +
  geom_smooth(method="loess")+
  labs(x = "Number of registered case (31 October 2020, ln scale)",y = "Number of registered death (ln scale)") +
  scale_x_continuous( trans = log_trans() )+
  scale_y_continuous( trans = log_trans() )
```

**level y - log x:**

Substantive reasoning: Level changes is harder to interpret
Statistical reasoning: log transformation shows the better approximation

**log y - level x:**

Substantive reasoning: it does not give better interpretation 
Statistical reasoning: log transformation of number of registered death and taking level of number of case does not give good approximation

**log y - log x**

Substantive reasoning: it is easier to interpret the percentage change in number of death per percentage change in confirmed case
Statistical reasoning: it shows the better approximation: making the association close to linear

```{r, echo = FALSE, warning = FALSE, message = FALSE}

# Add log of confirmed cases and log of number of death
df <- df %>% 
      mutate(ln_confirmed = log(confirmed),
             ln_death = log(death))

```


for 5% change in x, we observe 5% change in y value

